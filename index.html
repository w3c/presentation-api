<!DOCTYPE html><html lang="en-US"><head>
    <meta charset="UTF-8">
    <title>
      Presentation API
    </title>
    <style>
@media print {
     [data-anolis-spec]::after { content:"[" attr(data-anolis-spec) "]"; font-size:.6em; vertical-align:super; text-transform:uppercase }
    }
    </style>
    <link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet" type="text/css">
    <style type="text/css">
/* Note formatting taken from HTML5 spec */
    .note { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
    .note em, .warning em, .note i, .warning i { font-style: normal; }
    p.note, div.note { padding: 0.5em 2em; }
    span.note { padding: 0 2em; }
    .note p:first-child { margin-top: 0; }
    .note p:last-child { margin-bottom: 0; }
    p.note:before { content: 'NOTE: '; }

    .open-issue { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #fbfbe9; border-color: #faf9a5; }
    .open-issue em, .warning em, .open-issue i, .warning i { font-style: normal; }
    p.open-issue, div.open-issue { padding: 0.5em 2em; }
    span.open-issue { padding: 0 2em; }
    .open-issue p:first-child { margin-top: 0; }
    .open-issue p:last-child { margin-bottom: 0; }

    .non-normative { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
    p.non-normative:before { content: 'Non-normative: '; font-weight: bolder;}
    p.non-normative, div.non-normative { padding: 0.5em 2em; }


    /* Pre.idl formatting taken from HTML5 spec */
    pre.idl { border: solid thin #d3d3d3; background: #FCFCFC; color: black; padding: 0.5em 1em; position: relative; }
    pre.idl :link, pre.idl :visited { color: inherit; background: transparent; }
    pre.idl::before { content: "IDL"; font: bold small sans-serif;
    padding: 0.5em; background: white; position: absolute; top: 0;
    margin: -1px 0 0 -4em; width: 1.5em; border: thin solid;
    border-radius: 0 0 0 0.5em }

    /* .example idl formatting taken from HTML5 nightly spec */
    .example {
        display: block;
        color: #222222;
        background: #FCFCFC;
        border-left-style: solid;
        border-color: #c0c0c0;
        border-left-width: 0.25em;
        margin-left: 1em;
        padding-left: 1em;
        padding-bottom: 0.5em;
    }

    .algorithm li {
        margin-bottom: 0.5em;
    }

    .interface dd, .parameters dt {
        margin-bottom: 0.5em;
    }

    code { color: orangered; }
    table { border-collapse: collapse; border-style: hidden hidden none hidden; }
    table thead, table tbody { border-bottom: solid; }
    table td, table th { border-left: solid; border-right: solid; border-bottom: solid thin; vertical-align: top; padding: 0.2em; }
    dfn { font-weight: bolder; font-style: normal; }

    h2, h3 { padding-top: 1.3em; }
    h4 { padding-top: 1.2em; }

    #use-cases-and-requirements dd { margin-top: 0.5em; margin-bottom: 1em; }
    </style>
  </head>
  <body>
    <div class="head">
      
<!--begin-logo-->
<p><a href="http://www.w3.org/"><img alt="W3C" height="48" src="https://www.w3.org/Icons/w3c_home" width="72"></a></p>
<!--end-logo-->
      <h1>
        Presentation API
      </h1>
      <h2 class="no-num no-toc" id="w3c-first-public-working-draft-11-february-2015">
        <!-- Editor's Draft 11 February 2015 -->
         W3C First Public Working Draft 11 February 2015
      </h2>
      <dl>
        <dt>
          This version:
        </dt>
        <dd>
          <!--begin-link--><a href="http://w3c.github.io/presentation-api/ 
          ">http://w3c.github.io/presentation-api/ 
          </a><!--end-link-->
        </dd>
        <dt>
          Latest published version:
        </dt>
        <dd>
          <!--begin-link--><a href="http://www.w3.org/TR/presentation-api/ 
          ">http://www.w3.org/TR/presentation-api/ 
          </a><!--end-link-->
        </dd>
        <dt>
          Latest editor's draft:
        </dt>
        <dd>
          <!--begin-link--><a href="http://w3c.github.io/presentation-api/ 
          ">http://w3c.github.io/presentation-api/ 
          </a><!--end-link-->
        </dd>
        <dt>
          Version history:
        </dt>
        <dd>
          <!--begin-link--><a href="https://github.com/w3c/presentation-api/commits/ 
          ">https://github.com/w3c/presentation-api/commits/ 
          </a><!--end-link-->
        </dd>
        <dt>
          Participate:
        </dt>
        <dd>
          Send feedback to <a href="https://lists.w3.org/Archives/Public/public-secondscreen/">public-secondscreen@w3.org</a>
          or <a href="https://github.com/w3c/presentation-api/issues/new">open
          a new issue</a> (<a href="https://github.com/w3c/presentation-api/issues/">open issues</a>)
        </dd>
        <dt>
          Editor:
        </dt>
        <dd>
          <a href="mailto:dominik.rottsches@intel.com">Dominik Röttsches</a>,
          Intel
        </dd>
      </dl>
      <p class="copyright">
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
        © 2014 <a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
        and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document
        use</a> rules apply.
      </p>
      <hr>
    </div>
    <section>
      <h2 class="no-num no-toc" id="abstract">
        Abstract
      </h2>
      <p>
        This specification defines an API to enable web content to access
        external presentation-type displays and use them for presenting web
        content.
      </p>
    </section>
    <section>
      <h2 class="no-num no-toc" id="sotd">
        Status of This Document
      </h2>
      <p>
        <em>This section describes the status of this document at the time of
        its publication. Other documents may supersede this document. A list of
        current W3C publications and the latest revision of this technical
        report can be found in the <a href="http://www.w3.org/TR/">W3C
        technical reports index</a> at http://www.w3.org/TR/.</em>
      </p>
      <p>
        This document was published by the <a href="http://www.w3.org/2014/secondscreen/">Second Screen Presentation
        Working Group</a> as a First Public Working Draft. If you wish to make
        comments regarding this document, please send them to <a href="mailto:public-secondscreen@w3.org">public-secondscreen@w3.org</a>
        (<a href="mailto:public-secondscreen-request@w3.org?subject=subscribe">subscribe</a>,
        <a href="http://lists.w3.org/Archives/Public/public-secondscreen/">archives</a>).
        All comments are welcome.
      </p>
      <p>
        This document is a <b>work in progress</b> and is subject to change. It
        builds on the <a href="http://www.w3.org/2014/secondscreen/presentation-api/20141118/" title="Presentation API W3C Community Group Final Report">final report</a>
        (dated 18 November 2014) produced by the Second Screen Presentation
        Community Group. Algorithms have been drafted in particular. Most
        sections are still incomplete or underspecified. Privacy and security
        considerations are missing. A few open issues are noted inline. Please
        check the group's <a href="https://github.com/w3c/presentation-api/issues">issue tracker</a> on
        GitHub for an accurate list. Feedback from early experimentations is
        encouraged to allow the Second Screen Presentation Working Group to
        evolve the specification based on implementation issues.
      </p>
      <p>
        Publication as a First Public Working Draft does not imply endorsement
        by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership.
        This is a draft document and may be updated, replaced or obsoleted by
        other documents at any time. It is inappropriate to cite this document
        as other than work in progress.
      </p>
      <p>
        This document was produced by a group operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/" id="sotd_patent" rel="w3p:patentRules">5 February 2004
        <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
        <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="http://www.w3.org/2004/01/pp-impl/74168/status" rel="disclosure">public list of any patent disclosures</a> made in
        connection with the deliverables of the group; that page also includes
        instructions for disclosing a patent. An individual who has actual
        knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
        Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
        6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent
        Policy</a>.
      </p>
      <p>
        This document is governed by the <a href="http://www.w3.org/2014/Process-20140801/" id="w3c_process_revision">1 August 2014 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
      </p>
    </section>
    <section>
      <h2 class="no-num no-toc" id="table-of-contents">
        Table of Contents
      </h2>
<!--begin-toc-->
<ol class="toc">
 <li><a href="#introduction"><span class="secno">1 </span>
        Introduction
      </a></li>
 <li><a href="#use-cases-and-requirements-0"><span class="secno">2 </span>
        Use cases and requirements
      </a>
  <ol>
   <li><a href="#use-cases-0"><span class="secno">2.1 </span>
          Use cases
        </a></li>
   <li><a href="#requirements-0"><span class="secno">2.2 </span>
          Requirements
        </a>
    <ol>
     <li><a href="#functional-requirements"><span class="secno">2.2.1 </span>
            Functional requirements
          </a></li>
     <li><a href="#non-functional-requirements"><span class="secno">2.2.2 </span>
            Non-functional requirements
          </a></ol></ol></li>
 <li><a href="#conformance"><span class="secno">3 </span>
        Conformance
      </a></li>
 <li><a href="#terminology"><span class="secno">4 </span>
        Terminology
      </a></li>
 <li><a href="#example"><span class="secno">5 </span>
        Example
      </a>
  <ol>
   <li><a href="#starting-new-presentations-or-manually-connecting-to-existing-presentations"><span class="secno">5.1 </span>
          Starting new presentations or manually connecting to existing
          presentations
        </a></li>
   <li><a href="#automatically-reconnecting-to-existing-presentations"><span class="secno">5.2 </span>
          Automatically reconnecting to existing presentations
        </a></li>
   <li><a href="#open-questions"><span class="secno">5.3 </span>
          Open questions
        </a></li>
   <li><a href="#usage-on-remote-screen"><span class="secno">5.4 </span>
          Usage on remote screen
        </a></ol></li>
 <li><a href="#api"><span class="secno">6 </span>
        API
      </a>
  <ol>
   <li><a href="#common-idioms"><span class="secno">6.1 </span>
          Common idioms
        </a></li>
   <li><a href="#common-definitions"><span class="secno">6.2 </span>
          Common definitions
        </a></li>
   <li><a href="#interface-presentationsession"><span class="secno">6.3 </span>
          Interface <code>PresentationSession</code>
        </a>
    <ol>
     <li><a href="#posting-a-message-through-presentationsession"><span class="secno">6.3.1 </span>
            Posting a message through <code>PresentationSession</code>
          </a></li>
     <li><a href="#closing-a-presentationsession"><span class="secno">6.3.2 </span>
            Closing a <code>PresentationSession</code>
          </a></li>
     <li><a href="#event-handlers"><span class="secno">6.3.3 </span>
            Event Handlers
          </a></ol></ol></li>
 <li><a href="#interface-navigatorpresentation"><span class="secno">7 </span>
        Interface <code>NavigatorPresentation</code>
      </a>
  <ol>
   <li><a href="#starting-a-presentation-session"><span class="secno">7.1 </span>
          Starting a presentation session
        </a></li>
   <li><a href="#joining-a-presentation-session"><span class="secno">7.2 </span>
          Joining a presentation session
        </a></li>
   <li><a href="#establishing-a-presentation-connection"><span class="secno">7.3 </span>
          Establishing a presentation connection
        </a></li>
   <li><a href="#the-onavailablechange-eventhandler"><span class="secno">7.4 </span>
          The <code>onavailablechange</code> EventHandler
        </a></li>
   <li><a href="#adding-an-eventhandler-to-onavailablechange"><span class="secno">7.5 </span>
          Adding an <code>EventHandler</code> to <code>onavailablechange</code>
        </a></li>
   <li><a href="#removing-an-eventhandler"><span class="secno">7.6 </span>
          Removing an <code>EventHandler</code>
        </a></li>
   <li><a href="#monitoring-the-list-of-available-presentation-displays"><span class="secno">7.7 </span>
          Monitoring the list of available presentation displays
        </a></ol></li>
 <li><a href="#interface-availablechangeevent"><span class="secno">8 </span>
        <span>Interface <code>AvailableChangeEvent</code></span>
      </a></li>
 <li><a class="no-num" href="#security-and-privacy-considerations">
        Security and privacy considerations
      </a></li>
 <li><a class="no-num" href="#references">
        References
      </a></li>
 <li><a class="no-num" href="#acknowledgments">
        Acknowledgments
      </a></ol>
<!--end-toc-->
    </section>
    <section>
      <h2 id="introduction"><span class="secno">1 </span>
        Introduction
      </h2><em>This section is non-normative.</em>
      <p>
        This specification aims to make secondary displays such as a projector
        or a connected TV available to the web and takes into account displays
        that are attached using wired (HDMI, DVI or similar) and wireless
        technologies (MiraCast, Chromecast, DLNA, AirPlay or similar).
      </p>
      <p>
        Devices with limited screen size lack the ability to show content to a
        larger audience, for example a group of colleagues in a conference
        room, or friends and family at home. Showing content on an external
        large display helps to improve the perceived quality and impact of the
        presented content.
      </p>
      <p>
        At its core, this specification enables an exchange of messages between
        a requesting page and a presentation page shown in the secondary
        display. How those messages are transmitted is left to the UA in order
        to allow for use of display devices that can be attached in a wide
        variety of ways. For example, when a display device is attached using
        HDMI or MiraCast, the UA on the requesting device can render the
        requested presentation page in that same UA, but instead of displaying
        in a window on that same device, it can use whatever means the
        operating system provides for using those external displays. In that
        case, both the requesting page and the presentation page run on the
        requesting device and the operating system is used to route the
        presentation display output to the other display device. The second
        display device doesn't need to know anything about this spec or that
        the content involves HTML5.
      </p>
      <p>
        Alternately, some types of external displays may be able to render
        HTML5 themselves and may have defined their own way to send messages to
        that content. In that case, the UA on the requesting device would not
        need to render the presentation page itself. Instead, the UA could act
        as a proxy translating the request to show a page and the messages into
        the form understood by the display device.
      </p>
      <p>
        This way of attaching to displays could be enhanced in the future
        through definition of a standard protocol for delivering these types of
        messages that display devices could choose to implement.
      </p>
      <p>
        The API defined here is intended be used with UAs that attach to
        display devices through any of the above means.
      </p>
    </section>
    <section id="use-cases-and-requirements">
      <h2 id="use-cases-and-requirements-0"><span class="secno">2 </span>
        Use cases and requirements
      </h2>
      <section id="use-cases">
        <h3 id="use-cases-0"><span class="secno">2.1 </span>
          Use cases
        </h3>
        <dl>
          <dt>
            Presentations
          </dt>
          <dd>
            A user is preparing a set of slides for a talk. Using a web based
            service, she is editing her slides and speaker notes on the primary
            screen, while the secondary larger screen shows a preview of the
            current slide. When the slides are done, her mobile phone allows
            her to access them from an online service while on the go. Coming
            to the conference, using wireless display technology, she would
            like to present her slides on the stage screen from her mobile
            phone. The phone's touch screen helps her to navigate slides and
            presents a slide preview, while the projector shows her slides to
            the audience.
          </dd>
          <dt>
            Video and image sharing
          </dt>
          <dd>
            Using an online video or image sharing service, a user would like
            to show memorable moments to her friends. Using a device with a
            small screen, it is impossible to show the content to a large group
            of people. Connecting an external TV screen or projector to her
            device - with a cable or wirelessly - the online sharing service
            now makes use of the connected display, allowing a wider audience
            to enjoy the content. The web page shows UI elements that allow the
            user to trigger displaying content on the secondary display (e.g a
            "send to second screen" ) only if there is at least one secondary
            screen available.
          </dd>
          <dt>
            Multiplayer gaming
          </dt>
          <dd>
            Splitting the gaming experience into a near screen controller and a
            large screen visual experience, new gaming experiences can be
            created. Accessing the local display on the small screen device and
            an external larger display allows for richer web-based gaming
            experiences.
            <p class="open-issue">
              <a href="https://github.com/w3c/presentation-api/issues/27">ISSUE
              27: Define a multiplayer gaming use case</a>
            </p>
          </dd>
          <dt>
            Media flinging to multiple screens
          </dt>
          <dd>
            Alice enters a video sharing site using a browser on her tablet.
            Next, Alice picks her favorite video from the site, and the video
            starts to play on her tablet. While the video is playing Alice
            clicks a button "Share on different screen". The browser provides a
            user interface that lists all the screens Alice has around her
            home, asking her to select one. The screens are identified by names
            that are familiar to Alice. Alice picks one screen from the list,
            "Alice's big TV", and the video playback continues seamlessly on
            the selected screen. Next she decides to switch the playback to a
            different screen. She clicks the same button "Share on different
            screen" provided by the site, and the browser presents the user
            interface that lists all the screens. Alice picks another screen
            from the list, "Alice's kitchen TV", and the playback resumes on
            that screen. Video site also provides a feature to see the action
            (Alice is watching a soccer game) from different angle. Alice
            clicks a button "Select screen for additional angle", and the
            browser asks Alice similarly to select the screen to be used for
            playback. Alice picks "Alice's Projector" and the soccer game is
            shown on the projector from a different angle, in parallel to the
            content being played back on "Alice's kitchen TV".
            <p class="open-issue">
              <a href="https://github.com/w3c/presentation-api/issues/40">ISSUE
              40: Screen availability mechanism for multiple sessions</a>
            </p>
          </dd>
        </dl>
      </section>
      <section id="requirements">
        <h3 id="requirements-0"><span class="secno">2.2 </span>
          Requirements
        </h3>
        <p>
          The requirements enumerated in this section are derived from the
          <a href="#use-cases">use cases</a>.
        </p>
        <section>
          <h4 id="functional-requirements"><span class="secno">2.2.1 </span>
            Functional requirements
          </h4>
          <dl>
            <dt>
              Discovery &amp; availability
            </dt>
            <dd>
              The UA must provide a way to find out whether at least one
              secondary screen is available.
            </dd>
            <dt>
              Launching presentation
            </dt>
            <dd>
              The UA must provide a means of start sending content to the
              secondary screen.
            </dd>
            <dt>
              Resuming presentation
            </dt>
            <dd>
              The UA must be able to resume an existing session with content
              being displayed on the secondary screen.
            </dd>
            <dt>
              Communication
            </dt>
            <dd>
              The UA must enable exchanging data between the primary and the
              secondary screen in order to have a control channel between the
              primary and secondary page. The UA must not make assumptions
              about the the execution locality of the user agent of the remote
              page it communicates with (i.e. the secondary page might run on a
              remote user agent and thus the link between the two pages' UA
              must be loosely coupled).
            </dd>
            <dt>
              Signaling disconnection
            </dt>
            <dd>
              The UA must signal disconnection from the presentation page to
              the primary page and vice versa.
            </dd>
          </dl>
          <p class="note">
            Multi-screen enumeration and named identification requirement was
            removed after <a class="external free" href="http://lists.w3.org/Archives/Public/public-webscreens/2014Feb/0021.html" rel="nofollow">
            discussion on the mailing list</a>.
          </p>
        </section>
        <section>
          <h4 id="non-functional-requirements"><span class="secno">2.2.2 </span>
            Non-functional requirements
          </h4>
          <dl>
            <dt>
              Power saving friendly
            </dt>
            <dd>
              All API design decisions must be analyzed from a power efficiency
              point of view. Especially when using wireless display
              technologies or querying availability over a radio channel, care
              needs to be taken to design the API in a way that does not pose
              obstacles to using radio resources in an efficient way. For
              example, powering up the wireless display detection only when
              needed.
            </dd>
          </dl>
        </section>
      </section>
    </section>
    <section>
      <h2 id="conformance"><span class="secno">3 </span>
        Conformance
      </h2>
      <p>
        All diagrams, examples, and notes in this specification are
        non-normative, as are all sections explicitly marked non-normative.
        Everything else in this specification is normative.
      </p>
      <p>
        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
        "OPTIONAL" in this document are to be interpreted as described in RFC
        2119. For readability, these words do not appear in all uppercase
        letters in this specification. <a href="#refsRFC2119">[RFC2119]</a>
      </p>
      <p>
        Requirements phrased in the imperative as part of algorithms (such as
        "strip any leading space characters" or "return false and terminate
        these steps") are to be interpreted with the meaning of the key word
        ("must", "should", "may", etc.) used in introducing the algorithm.
      </p>
      <p>
        Conformance requirements phrased as algorithms or specific steps may be
        implemented in any manner, so long as the end result is equivalent. (In
        particular, the algorithms defined in this specification are intended
        to be easy to follow, and not intended to be performant.)
      </p>
    </section>
    <section>
      <h2 id="terminology"><span class="secno">4 </span>
        Terminology
      </h2>
      <p>
        The terms <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#browsing-context">browsing context</a>,
        <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#event-handlers">event handlers</a>, <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#event-handler-event-type" title="event handler event type">event handler
        event types</a>, <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">firing an event</a>, <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#navigate">navigate</a>, <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task" title="queue a task">queing a task</a> are defined in
        <a href="#refsHTML5">[HTML5]</a>.
      </p>
      <p>
        The term <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a> is defined in <a href="#refsES6">[ES6]</a>. The terms <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">resolving a Promise, and rejecting a Promise</a>
        are used as explained in <a href="#refsPROMGUIDE">[PROMGUIDE]</a>.
      </p>
      <p>
        The term <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#url">URL</a> is defined in the
        WHATWG URL standard: <a href="#refsURL">[URL]</a>.
      </p>
      <p>
        This document provides interface definitions using the
        <a href="#refsWEBIDL">[WEBIDL]</a> standard.
      </p>
    </section>
    <section>
      <h2 id="example"><span class="secno">5 </span>
        Example
      </h2>
      <p class="open-issue">
        <a href="https://github.com/w3c/presentation-api/issues/42">ISSUE 42:
        Make the Example section more concise</a>
      </p>
      <p>
        Running in a compliant user agent, code for presenting a page
        <code>http://example.org/presentation.html</code> on the presentation
        display looks as follows:
      </p>
      <pre class="example">/* controller.html */

&lt;button disabled id=show&gt;Show&lt;/button&gt;
&lt;button disabled id=stop&gt;Stop&lt;/button&gt;

&lt;script&gt;

var presentation = navigator.presentation,
    showButton = document.getElementById('show'),
    stopButton = document.getElementById('stop');

var session = null;
var screenAvailable = false;
var presentationUrl = 'http://example.org/presentation.html';
var presentationId = localStorage['presentationId'] ||
    new String((Math.random() * 10000).toFixed(0));

// Join an existing presentation if one exists.
presentation.joinSession(presentationUrl, presentationId).then(
    function(existingSession) {
      setSession(existingSession);
      updateButtons();
    },
    function() {
      // No session to join.
    });

presentation.onavailablechange = function(e) {
  screenAvailable = e.available;
  updateButtons();
};

function updateButtons() {
  stopButton.disabled = !session;
  stopButton.onClick = session ? stopPresent : null;
  showButton.disabled = !screenAvailable;
  showButton.onclick = screenAvailable ? startPresent : null;
};

function startPresent() {
  presentation.startSession(presentationUrl, presentationId).then(
      function(newSession) {
        setSession(newSession);
        updateButtons();
      },
      function() {
        // User cancelled, etc.
      });
};

function stopPresent() {
  if (!session) return;
  session.close();
  delete localStorage['presentationId'];
};

function setSession(theSession) {
  // NOTE: We could instead close the current session.
  if (session) return;
  session = theSession;
  localStorage['presentationId'] = session.id;
  session.onstatechange = function() {
    switch (session.state) {
      case 'connected':
        session.postMessage(/*...*/);
        session.onmessage = function() { /*...*/ };
        break;
      case 'disconnected':
        console.log('Disconnected.');
        break;
    }
  };
}
&lt;/script&gt;
</pre>
      <p class="open-issue">
        We could simplify the example, and perhaps remove UI button state
        management for the sake of clarity.
      </p>
      <p>
        The availability monitoring for secondary screens begins when the page
        adds an event listener for the <code>availablechange</code> event on
        the <code>navigator.presentation</code> object. If there are already
        available screens when the page adds the first event listener for the
        event, the UA synthesizes a single <code>availablechange</code> event
        to signal the availability.
      </p>
      <p class="open-issue">
        <a href="https://github.com/w3c/presentation-api/issues/8">ISSUE 8:
        Timing of availablechange event to signal screen availability</a>
      </p>
      <p class="open-issue">
        <a href="https://github.com/w3c/presentation-api/issues/9">ISSUE 9: How
        to filter available screens according to the content being
        presented</a>
      </p>
      <section>
        <h4 id="starting-new-presentations-or-manually-connecting-to-existing-presentations"><span class="secno">5.1 </span>
          Starting new presentations or manually connecting to existing
          presentations
        </h4>
        <p>
          The "Show" button's state (initially disabled) informs the user of
          the availability of secondary screen(s), and the button's state is
          updated if the availability changes. (The rationale of putting the
          actual boolean information into a property of the event
          <code>e.available</code> is to allow the implementation to optimize
          power consumption for network discovery of remote wireless screens.
          If this information was provided in a globally accessible flag, the
          network discovery could never be suspended for keeping the flag up to
          date.)
        </p>
        <p>
          Clicking the "Show" button calls
          <code>navigator.presentation.startSession()</code>, which causes the
          user agent to request from the user a screen to show the
          presentation. The <code>url</code> argument indicates the content to
          be presented. The <code>presentationId</code> argument (optional)
          allows the page to identify this presentation instance, and control
          which other pages may connect to it by setting a hard-to-guess id.
        </p>
        <p class="open-issue">
          As previously discussed on the mailing list - we can add convenience
          here by default-generating an ID.
        </p>
        <p>
          If the user selects a screen with an existing presentation showing
          the same <code>url</code> under the same <code>presentationId</code>,
          the <a href="#opening-browsing-context">opening browsing context</a> is connected to that
          existing presentation. If the user selects a screen without an
          existing presentation, or a screen presenting a different
          <code>url</code> or <code>presentationId</code>, the UA connects to
          the selected screen, brings up a new presentation window on it, and
          starts to show the content denoted by the <code>url</code> argument.
          The UA then connects the <a href="#opening-browsing-context">opening browsing context</a> to
          this new presentation and allows the <a href="#opening-browsing-context">opening browsing
          context</a> to exchange messages with it.
        </p>
        <p>
          <code>navigator.presentation.startSession(url, presentationId)</code>
          returns a <code>Promise</code> to the <a href="#opening-browsing-context">opening browsing
          context</a>. When the user selects a screen, the presentation page
          is shown and a communication channel has been established the
          <code>Promise</code> resolves to a <a href="#presentationsession"><code>PresentationSession</code></a>
          object, which acts as a handle to the presentation for communication
          and state handling. Initially, the state of the
          <a href="#presentationsession"><code>PresentationSession</code></a> is <code>"connected"</code>. At this
          point, the <a href="#opening-browsing-context">opening browsing context</a> can communicate with
          the presentation page using the session's <code>postMessage()</code>
          to send messages and its <a href="#onmessage"><code>onmessage</code></a> event handler to
          receive messages. The presentation page will also have access to
          <a href="#presentationsession"><code>PresentationSession</code></a> that it can use to send and receive
          messages with the <a href="#opening-browsing-context">opening browsing context</a> (see <a href="#usage-on-remote-screen">Usage on remote screen</a>).
        </p>
        <p>
          If the user cancels screen selection, the <code>Promise</code>
          returned by <code>startSession(url, presentationId)</code> remains
          unresolved.
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/20">ISSUE 20:
          Define return value for cancelled/missing session for
          <code>startSession()</code>/<code>joinSession()</code></a>
        </p>
        <p>
          While there is a pending call to <a href="#startsession"><code>startSession</code></a> asking the
          user to select a screen (that the user has not yet accepted or
          canceled), the browser may choose to reject subsequent calls to
          <a href="#startsession"><code>startSession</code></a> from the same page, by returning a
          <code>Promise</code> that never resolves. This will prevent the
          browser from needing to 'queue up' requests to present to the user.
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/21">ISSUE 21:
          Define whether multiple simultaneous calls are permitted to
          <code>startSession()</code></a>
        </p>
      </section>
      <section>
        <h4 id="automatically-reconnecting-to-existing-presentations"><span class="secno">5.2 </span>
          Automatically reconnecting to existing presentations
        </h4>
        <p>
          The <a href="#opening-browsing-context">opening browsing context</a> may wish to reconnect to an
          existing presentation without prompting the user to select a screen.
          For example, the site could allow media items from different pages to
          be shown on the same presentation page, and does not want to prompt
          the user on each page to reconnect to that presentation. To reconnect
          automatically, the page may call <code>joinSession(url,
          presentationId)</code>, which returns a <code>Promise</code> that
          resolves to an existing <a href="#presentationsession"><code>PresentationSession</code></a> if one
          exists that is presenting the same <code>url</code> with the same
          <code>presentationId</code> as was passed originally into
          <a href="#startsession"><code>startSession</code></a>. The <a href="#opening-browsing-context">opening browsing context</a>
          can then communicate with the presentation as if the user had
          manually connected to it via <a href="#startsession"><code>startSession</code></a>.
        </p>
        <p>
          At the time <code>joinSession(url, presentationId)</code> method is
          called, if the browser is not aware of any
          <a href="#presentationsession"><code>PresentationSession</code></a> with a matching <code>url</code> and
          <code>presentationId</code>, the <code>Promise</code> should remain
          unresolved. The browser may become aware of such a session at a later
          time (for example, by switching to a WiFi network that has a screen
          showing that URL). In this case, the browser may resolve the Promise
          to allow the page to connect to the running session.
        </p>
        <p>
          If the browser knows of multiple matching sessions, it should connect
          the page to the session that was most recently connected to; if that
          cannot be determined by the browser (for example, if the matching
          sessions have never been connected), then the <code>Promise</code>
          should remain unresolved.
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/39">ISSUE 39:
          Resumption of multiple sessions</a>
        </p>
        <p>
          If the page calls <code>startSession(url, presentationId)</code> and
          there is a pending <code>Promise</code> from a call to
          <code>joinSession(url, presentationId)</code> (with the same
          <code>url</code> and <code>presentationId</code>, and the user
          selects a screen in response to <a href="#startsession"><code>startSession</code></a>, then the
          <code>Promise</code> from <a href="#startsession"><code>startSession</code></a> will be resolved
          and the <code>Promise</code> from <a href="#joinsession"><code>joinSession</code></a> will not.
        </p>
      </section>
      <section>
        <h4 id="open-questions"><span class="secno">5.3 </span>
          Open questions
        </h4>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/10">ISSUE 10:
          Is user permission required to prompt for screen availability
          information?</a>
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/12">ISSUE 12:
          Necessity of an additional state to indicate a session was
          resumed</a>
        </p>
      </section>
      <section>
        <h3 id="usage-on-remote-screen"><span class="secno">5.4 </span>
          Usage on remote screen
        </h3>
        <p>
          For addressing the requirement of communication between originating
          page and presentation page/screen, the presenting page can now use
          the same <code>session</code> object. It accesses this object through
          the <code>navigator.presentation.session</code> property, which is
          only non-<code>null</code> for the page on the presentation screen.
        </p>
        <pre class="example">if (navigator.presentation.session) {
  var session = navigator.presentation.session;
  // Communicate with opening browsing context
  session.postMessage(/*...*/);
  session.onmessage = function() {/*...*/};

  session.onstatechange = function() {
    switch (this.state) {
      case "disconnected":
        // Handle disconnection from opening browsing context
    }
  };
};
</pre>
        <p>
          When the content denoted by the <code>url</code> argument in the
          <code>startSession()</code> example above is loaded, the page on the
          presentation screen will have its
          <code>navigator.presentation.session</code> property set to the
          session. This session is a similar object as in the first example.
          Here, its initial state is <code>"connected"</code>, which means we
          can use it to communicate with the <a href="#opening-browsing-context">opening browsing
          context</a> using <code>postMessage()</code> and
          <a href="#onmessage"><code>onmessage</code></a>.
        </p>
        <p>
          The presentation page can also monitor the connection state by
          listening for <code>statechange</code> events. When the state changes
          to <code>"disconnected"</code> the page is made aware of the fact
          that communication with the <a href="#opening-browsing-context">opening browsing context</a> was
          lost, but it can continue to display the current content. The
          communication can be re-established when a <code>statechange</code>
          event fires with a new state of <code>"connected"</code>.
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/19">ISSUE 19:
          Specify behavior when multiple controlling pages are connected to the
          session</a>
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/18">ISSUE 18:
          Define reconnection for cross-page navigation on presenting user
          agent</a>
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/14">ISSUE 14:
          Define user agent context for rendering the presentation</a>
        </p>
      </section>
    </section>
    <section>
      <h2 id="api"><span class="secno">6 </span>
        API
      </h2>
      <section>
        <h3 id="common-idioms"><span class="secno">6.1 </span>
          Common idioms
        </h3>
        <p>
          A <dfn id="presentation-display">presentation display</dfn> refers to an external screen
          available to the user agent via an implementation specific connection
          technology.
        </p>
        <p>
          A <dfn id="concept-presentation" title="concept-presentation">presentation</dfn> is an active
          connection between a user agent and a <a href="#presentation-display">presentation
          display</a> for displaying web content on the latter at the
          request of the former.
        </p>
        <p>
          A <dfn id="concept-presentation-session" title="concept-presentation-session">presentation
          session</dfn> is an object relating an <a href="#opening-browsing-context">opening browsing
          context</a> to its <a href="#presentation-display">presentation display</a> and enabling
          two-way-messaging between them. Each such object has a
          <dfn id="presentation-session-state">presentation session state</dfn> and a <dfn id="presentation-session-identifier">presentation session
          identifier</dfn> to distinguish it from other <a href="#concept-presentation-session" title="concept-presentation-session">presentation sessions</a>.
        </p>
        <p>
          An <dfn id="opening-browsing-context">opening browsing context</dfn> is a <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#browsing-context">browsing context</a> that has initiated or resumed a
          <span>presentation session</span> by calling
          <code><a href="#startsession">startSession</a>()</code> or
          <code><a href="#joinsession">joinSession</a>()</code>.
        </p>
      </section>
      <section>
        <h3 id="common-definitions"><span class="secno">6.2 </span>
          Common definitions
        </h3>
        <p>
          Let <em>D</em> be the set of presentations that are currently known
          to the user agent (regardles of their state). <em>D</em> is
          represented as a set of tuples <em>(U, I, S)</em> where <em>U</em> is
          the <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#url">URL</a> that is being presented;
          <em>I</em> is an alphanumeric identifier for the presentation; and
          <em>S</em> is the user agent's <a href="#presentationsession"><code>PresentationSession</code></a> for
          the presentation. <em>U</em> and <em>I</em> together uniquely
          identify the <a href="#presentationsession"><code>PresentationSession</code></a> of the corresponding
          presentation.
        </p>
      </section>
      <section>
        <h3 id="interface-presentationsession"><span class="secno">6.3 </span>
          Interface <a href="#presentationsession"><code>PresentationSession</code></a>
        </h3>
        <p>
          Each <a href="#concept-presentation-session" title="concept-presentation-session">presentation
          session</a> is represented by a <a href="#presentationsession"><code>PresentationSession</code></a>
          object.
        </p>
        <pre class="idl">enum <dfn id="presentationsessionstate">PresentationSessionState</dfn> { "connected", "disconnected" /*, "resumed" */ };

interface <dfn id="presentationsession">PresentationSession</dfn> : EventTarget {
  readonly DOMString? <a href="#id">id</a>;
  readonly attribute <a href="#presentationsessionstate">PresentationSessionState</a> <a href="#state">state</a>;
  void <a href="#postmessage">postMessage</a>(DOMString message);
  void <a href="#close">close</a>();
  attribute <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler">EventHandler</a> <a href="#onmessage">onmessage</a>;
  attribute <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler">EventHandler</a> <a href="#onstatechange">onstatechange</a>;
};
</pre>
        <p>
          The <dfn id="id"><code>id</code></dfn> attribute holds the alphanumeric
          <a href="#presentation-session-identifier">presentation session identifier</a>.
        </p>
        <p>
          The <dfn id="state"><code>state</code></dfn> attribute represents the
          <span>presentation session</span>'s current state. It can take one of
          the values of <a href="#presentationsessionstate"><code>PresentationSessionState</code></a>
          depending on connection state.
        </p>
        <p>
          When the <code><dfn id="postmessage">postMessage</dfn>()</code> method is called on a
          <a href="#presentationsession"><code>PresentationSession</code></a> object with a <code>message</code>,
          the user agent must run the algorithm to <a href="#algorithm-post-message" title="algorithm-post-message">post a message through a
          <span><code>PresentationSession</code></span></a>.
        </p>
        <p>
          When the <code><dfn id="close">close</dfn>()</code> method is called on a
          <a href="#presentationsession"><code>PresentationSession</code></a>, the user agent must run the
          algorithm to <a href="#close-algorithm" title="close-algorithm">close a presentation
          session</a>.
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/34">ISSUE 34:
          Specify the presentation initialization algorithm</a>
        </p>
        <section>
          <h4 id="posting-a-message-through-presentationsession"><span class="secno">6.3.1 </span>
            Posting a message through <a href="#presentationsession"><code>PresentationSession</code></a>
          </h4>
          <p>
            When the user agent is to <dfn id="algorithm-post-message" title="algorithm-post-message">post
            a message through a <code>PresentationSession</code> S</dfn>, it
            must run the following steps:
          </p>
          <p class="open-issue">
            <a href="https://github.com/w3c/presentation-api/issues/46">ISSUE
            46: Define postMessage behavior</a>
          </p>
        </section>
        <section>
          <h4 id="closing-a-presentationsession"><span class="secno">6.3.2 </span>
            Closing a <a href="#presentationsession"><code>PresentationSession</code></a>
          </h4>
          <p>
            When the user agent is to <dfn id="close-algorithm" title="close-algorithm">close a
            presentation session S</dfn>, it must run the following steps:
          </p>
          <ol>
            <li>If <em>S.state</em> is not <code>connected</code>, then:
              <ol>
                <li>Abort these steps.
                </li>
              </ol>
            </li>
            <li>Set <em>S.state</em> to <code>disconnected</code>.
            </li>
            <li>Let <em>D</em> be the set of presentations known by the user
            agent.
            </li>
            <li>
              <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> <em>T</em>
              to run the following steps in order:
              <ol>
                <li>For each presentation <em>(U, I, S')</em> in <em>D</em>,
                  <ol>
                    <li>Let <em>u</em> equal <em>U</em>, <em>i</em> equal <em>
                      I</em>, and <em>s</em> equal <em>S'</em>.
                    </li>
                    <li>If <em>u</em> is equal to <em>S.url</em> and <em>i</em>
                    is equal to <em>S.id</em>, run the following steps:
                      <ol>
                        <li>
                          <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a>
                          to <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a> named
                          <code>statechange</code> at <em>s.onstatechange</em>.
                        </li>
                      </ol>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
          </ol>
          <p class="open-issue">
            <a href="https://github.com/w3c/presentation-api/issues/35">ISSUE
            35: Refine how to do session teardown/disconnect/closing</a>
          </p>
        </section>
        <section>
          <h4 id="event-handlers"><span class="secno">6.3.3 </span>
            Event Handlers
          </h4>
          <p>
            The following are the event handlers (and their corresponding event
            handler event types) that must be supported, as event handler IDL
            attributes, by objects implementing the
            <a href="#presentationsession"><code>PresentationSession</code></a> interface:
          </p>
          <table>
            <thead>
              <tr>
                <th>
                  Event handler
                </th>
                <th>
                  Event handler event type
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <dfn id="onmessage"><code>onmessage</code></dfn>
                </td>
                <td>
                  <code>message</code>
                </td>
              </tr>
              <tr>
                <td>
                  <dfn id="onstatechange"><code>onstatechange</code></dfn>
                </td>
                <td>
                  <code>statechange</code>
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
    </section>
    <section>
      <h3 id="interface-navigatorpresentation"><span class="secno">7 </span>
        Interface <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a>
      </h3>
      <pre class="idl">partial interface <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#navigator">Navigator</a> {
  readonly attribute <a href="#navigatorpresentation">NavigatorPresentation</a> <a href="#presentation">presentation</a>;
};
</pre>
      <p>
        The <dfn id="presentation"><code>presentation</code></dfn> attribute is used to retrieve
        an instance of the <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a> interface, the
        main interface of Presentation API.
      </p>
      <pre class="idl">interface <dfn id="navigatorpresentation">NavigatorPresentation</dfn> : EventTarget {
  readonly attribute <a href="#presentationsession">PresentationSession</a>? <span>session</span>;
  Promise&lt;<a href="#presentationsession">PresentationSession</a>&gt; <a href="#startsession">startSession</a>(DOMString url, DOMString? presentationId);
  Promise&lt;<a href="#presentationsession">PresentationSession</a>&gt; <a href="#joinsession">joinSession</a>(DOMString url, DOMString? presentationId);
  attribute <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler">EventHandler</a> <a href="#onavailablechange">onavailablechange</a>;
};
</pre>
      <p class="open-issue">
        <a href="https://github.com/w3c/presentation-api/issues/52">ISSUE 52:
        Specify the NavigatorPresentation.session attribute and its related
        algorithms</a>
      </p>
      <section>
        <h4 id="starting-a-presentation-session"><span class="secno">7.1 </span>
          Starting a presentation session
        </h4>
        <p>
          When the <code><dfn id="startsession">startSession</dfn>(presentationUrl,
          presentationId)</code> method is called, the user agent must run the
          following steps:
        </p>
        <dl>
          <dt>
            Input
          </dt>
          <dd>
            <code>presentationUrl</code>, the <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#url">URL</a> of the document to be presented
          </dd>
          <dd>
            <code>presentationId</code>, an optional identifier for the
            presentation
          </dd>
          <dt>
            Output
          </dt>
          <dd>
            <em>P</em>, a <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a>
          </dd>
        </dl>
        <ol>
          <li>Let <em>P</em> be a new <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a>.
          </li>
          <li>Return <em>P</em>.
          </li>
          <li>If the user agent does not <span>monitor presentation display
          availability</span>, run the following steps:
            <ol>
              <li>
                <span>Monitor presentation display availability</span>.
              </li>
              <li>Wait until the algorithm completes.
              </li>
            </ol>
          </li>
          <li>If the <a href="#availabledisplays">availableDisplays</a> list is
          empty, then:
            <ol>
              <li>
                <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Reject</a> <em>P</em> with a
                "NoScreensAvailable" exception.
              </li>
              <li>Abort all remaining steps.
              </li>
            </ol>
          </li>
          <li>Queue a task <em>T</em> to request user permission for the use of
          a <a data-anolis-ref="presentation" href="#presentation-display">presentation display</a>
          and selection of one presentation display.
            <ol>
              <li>If <em>T</em> completes with the user <em>granting
              permission</em> to use a screen, run the following steps:
                <ol>
                  <li>If <code>presentationId</code> is not <em>undefined</em>,
                  assign <em>I</em> to that that <code>presentationId</code>.
                  </li>
                  <li>If <code>presentationId</code> is <code>undefined</code>,
                  let <em>I</em> be a random alphanumeric value of at least 16
                  characters drawn from the characters
                  <code>[A-Za-z0-9]</code>.
                  </li>
                  <li>Create a new <a href="#presentationsession"><code>PresentationSession</code></a> <em>S</em>.
                  </li>
                  <li>Set <code>S.url</code> to <code>presentationUrl</code>,
                  set <code>S.id</code> to <em>I</em>, and set
                  <code>S.state</code> to <code>disconnected</code>.
                  </li>
                  <li>
                    <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a>
                    <em>C</em> to create a new <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#browsing-context">browsing context</a> on the user-selected
                    <a href="presentation-display">presentation display</a> and
                    <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#navigate">navigate</a> to
                    <code>presentationUrl</code> in it.
                    <ol>
                      <li>If <em>C</em> completes successfully, run the
                      following steps:
                        <ol>
                          <li>Add <em>(S.url, S.id, S)</em> to <em>D</em>.
                          </li>
                          <li>
                            <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Resolve</a> <em>P</em> with
                            <em>S</em>.
                          </li>
                          <li>
                            <a href="#establish-a-presentation-connection">Establish a presentation connection</a>
                            with <em>S</em>.
                          </li>
                        </ol>
                      </li>
                      <li>If <em>C</em> fails, run the following steps:
                        <ol>
                          <li>
                            <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Reject</a> P with a "failed"
                            exception.
                          </li>
                        </ol>
                      </li>
                    </ol>
                  </li>
                </ol>
              </li>
              <li>If <em>T</em> completes with the user <em>denying
              permission</em>, run the following steps:
                <ol>
                  <li>
                    <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Reject</a> <em>P</em> with a
                    "PermissionDenied" exception.
                  </li>
                </ol>
              </li>
            </ol>
          </li>
        </ol>
        <p class="note">
          The details of implementing the permission request and display
          selection are left to the user agent; for example it may show the
          user a dialog and allow the user to select an available screen
          (granting permission), or cancel the selection (denying permission).
        </p>
        <p class="open-issue">
          ISSUE: Do we want to distinguish the permission-denied outcome from
          the no-screens-available outcome? Developers would be able to infer
          it anyway from <a href="#onavailablechange"><code>onavailablechange</code></a>.
        </p>
      </section>
      <section>
        <h4 id="joining-a-presentation-session"><span class="secno">7.2 </span>
          Joining a presentation session
        </h4>
        <p>
          When the <code><dfn id="joinsession">joinSession</dfn>(presentationUrl,
          presentationId)</code> method is called, the user agent must run the
          following steps:
        </p>
        <dl>
          <dt>
            Input
          </dt>
          <dd>
            <code>presentationUrl</code>, the <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#url">URL</a> of the document being presented
          </dd>
          <dd>
            <code>presentationId</code>, the identifier for the presentation
          </dd>
          <dt>
            Output
          </dt>
          <dd>
            <em>P</em>, a <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a>
          </dd>
        </dl>
        <ol>
          <li>Let <em>P</em> be a new <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a>.
          </li>
          <li>Return <em>P</em>.
          </li>
          <li>Let <em>D</em> be the set of presentations known by the user
          agent.
          </li>
          <li>
            <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> <em>T</em> to
            run the following steps in order:
            <ol>
              <li>For each presentation <em>(U, I, S)</em> in <em>D</em>,
                <ol>
                  <li>Let <em>u</em> equal <em>U</em>, <em>i</em> equal
                  <em>I</em>, and <em>s</em> equal <em>S</em>.
                  </li>
                  <li>If <em>u</em> is equal to <code>presentationUrl</code>
                  and <em>i</em> is equal to <code>presentationId</code>, run
                  the following steps:
                    <ol>
                      <li>
                        <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Resolve</a> <em>P</em> with
                        <em>S</em>.
                      </li>
                      <li>
                        <a href="#establish-a-presentation-connection">Establish a presentation connection</a> with
                        <em>S</em>.
                      </li>
                      <li>Abort the remaining steps of <em>T</em>.
                      </li>
                    </ol>
                  </li>
                </ol>
              </li>
              <li>
                <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Reject</a> <em>P</em> with a
                "NoPresentationFound" exception.
              </li>
            </ol>
          </li>
        </ol>
        <p class="open-issue">
          ISSUE: If no matching presentation is found, we could leave the
          Promise pending in case a matching presentation is started in the
          future.
        </p>
      </section>
      <section>
        <h4 id="establishing-a-presentation-connection"><span class="secno">7.3 </span>
          Establishing a presentation connection
        </h4>
        <p>
          When the user agent is to <dfn id="establish-a-presentation-connection">establish a presentation
          connection</dfn> using a <span>presentation session</span>
          <em>S</em>, it must run the following steps:
        </p>
        <ol>
          <li>If <em>S.state</em> is <code>connected</code>, then:
            <ol>
              <li>Abort all remaining steps.
              </li>
            </ol>
          </li>
          <li>
            <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> <em>T</em> to
            connect <em>S</em> to the document that is presenting
            <em>S.url</em>.
          </li>
          <li>If <em>T</em> completes successfully, run the following steps:
            <ol>
              <li>Set <em>S.state</em> to <code>connected.</code>
              </li>
              <li>Let <em>D</em> be the set of presentations known by the user
              agent.
              </li>
              <li>Queue a task <em>T</em> to run the following steps in order:
                <ol>
                  <li>For each presentation <em>(U, I, S')</em> in <em>D</em>,
                    <ol>
                      <li>Let <em>u</em> equal <em>U</em>, <em>i</em> equal
                      <em>I</em>, and <em>s</em> equal <em>S'</em>.
                      </li>
                      <li>If <em>u</em> is equal to <em>S.url</em> and
                      <em>i</em> is equal to <em>S.id</em>, run the following
                      steps:
                        <ol>
                          <li>
                            <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a
                            task</a> to <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a>
                            named <code>statechange</code> at
                            <em>s.onstatechange</em>.
                          </li>
                        </ol>
                      </li>
                    </ol>
                  </li>
                </ol>
              </li>
            </ol>
          </li>
        </ol>
        <p class="note">
          The mechanism that is used to present on the remote display and
          connect the <a href="#opening-browsing-context">opening browsing context</a> with the presented
          document is an implementation choice of the user agent. The
          connection must provide a two-way messaging abstraction capable of
          carrying <code>DOMString</code> payloads in a reliable and in-order
          fashion as described in the <em>Send Message</em> and <em>Receive
          Message</em> steps below.
        </p>
        <p class="note">
          If <em>T</em> does not complete successfully, the user agent may
          choose to re-execute the Presentation Connection algorithm at a later
          time.
        </p>
        <p class="open-issue">
          ISSUE: Do we want to notify the caller of a failure to connect, i.e.
          with an "error" onstatechange?
        </p>
        <p class="open-issue">
          ISSUE: Do we want to pass the new state as a property of the
          statechange event?
        </p>
      </section>
      <section>
        <h4 id="the-onavailablechange-eventhandler"><span class="secno">7.4 </span>
          The <a href="#onavailablechange"><code>onavailablechange</code></a> EventHandler
        </h4>
        <p>
          <span>The following are the event handlers (and their corresponding
          event handler event types) that must be supported, as event handler
          IDL attributes, by objects implementing the
          <a href="#presentationsession"><code>PresentationSession</code></a> interface:</span>
        </p>
        <table>
          <thead>
            <tr>
              <th>
                Event handler
              </th>
              <th>
                Event handler event type
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <dfn id="onavailablechange"><code>onavailablechange</code></dfn>
              </td>
              <td>
                <code>availablechange</code>
              </td>
            </tr>
          </tbody>
        </table>
        <p>
          In order to satisfy the <span title="non-functional-requirements">power saving non-functionional
          requirements</span> the user agent must keep track of the number of
          <code>EventHandler</code>s registered to the <code>onavailable</code>
          event. Using this information, implementation specific discovery of
          <span title="presentation-display">presentation displays</span> can
          be resumed or suspended, in order to save power.
        </p>The user agent must keep a <dfn id="list-of-available-presentation-displays">list of available presentation
        displays</dfn>. According to the number of event handlers for
        <a href="#onavailablechange"><code>onavailablechange</code></a>, the user agent must also keep the list
        up to date by running the algorithm for <a href="#algorithm-monitor-available" title="algorithm-monitor-available">monitoring the list of available
        presentation displays</a>.
      </section>
      <section>
        <h5 id="adding-an-eventhandler-to-onavailablechange"><span class="secno">7.5 </span>
          Adding an <code>EventHandler</code> to <a href="#onavailablechange"><code>onavailablechange</code></a>
        </h5>
        <p>
          When an event handler is added to the list of event handlers
          registered for the <a href="#onavailablechange"><code>onavailablechange</code></a> event, the user
          agent must run the <a href="#algorithm-monitor-available" title="algorithm-monitor-available">algorithm to monitor the list of
          available presentation displays</a>.
        </p>
      </section>
      <section>
        <h5 id="removing-an-eventhandler"><span class="secno">7.6 </span>
          Removing an <code>EventHandler</code>
        </h5>
        <p>
          When an event handler is removed from the list of event handlers
          registered to the <a href="#onavailablechange"><code>onavailablechange</code></a> event, the user
          agent must run the following steps:
        </p>
        <ol>
          <li>If the removed event handler was the last one in the list, <a href="#cancel-monitoring-the-list-of-available-presentation-displays">
            cancel monitoring the list of available presentation
            displays</a>.
          </li>
        </ol>
      </section>
      <section>
        <h5 id="monitoring-the-list-of-available-presentation-displays"><span class="secno">7.7 </span>
          Monitoring the list of available presentation displays
        </h5>
        <p>
          When the user agent is to <dfn id="algorithm-monitor-available" title="algorithm-monitor-available">monitor the list of available
          presentation displays</dfn>, it must run the following steps:
        </p>
        <p>
          While there are <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#event-handlers">event
          handlers</a> added to NavigatorPresentation.onavailablechange, the
          user agent must continuously keep track the <a href="#list-of-available-presentation-displays">list of available
          presentation displays</a> and repeat the following steps:
        </p>
        <ol>
          <li>
            <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to retrieve
            the the list of curently available <a href="#presentation-display">presentation displays</a> and let <a id="newdisplays"><em>newDisplays</em></a> be this list.
          </li>
          <li>Wait for the completion of that task.
          </li>
          <li>If <a href="#availabledisplays">availableDisplays</a> is empty
          and <a href="#newdisplays">newDisplays</a> is not empty, then
            <ol>
              <li>
                <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
                <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a> named
                <code>availablechange</code> at with the event's
                <code>available</code> property set to <code>true</code>.
              </li>
            </ol>
          </li>
          <li>If <a href="#availabledisplays">availableDisplays</a> is not
          empty and <a href="#newdisplays">newDisplays</a> is empty, then:
            <ol>
              <li>
                <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
                <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a> named
                <code>availablechange</code> with the event's
                <code>available</code> property set to <code>false</code>.
              </li>
            </ol>
          </li>
          <li>Set the <a href="#list-of-available-presentation-displays">list of available presentation displays</a> to
          the value of <a href="#newDisplays">newDisplays</a>.
          </li>
        </ol>
        <p class="note">
          The mechanism used to monitor <a href="#presentation-display">presention displays</a> availability is left
          to the user agent. The user agent may choose search for screens at
          any time, not just when event handlers are added to
          <code>NavigatorPresentation.onavailablechange</code>.
        </p>
        <p>
          When the user agent is to <dfn id="cancel-monitoring-the-list-of-available-presentation-displays">cancel monitoring the list of
          available presentation displays</dfn>, it must run the following
          steps:
        </p>
        <ol>
          <li>Cancel any tasks to retrieve the list of available <a href="#presentation-display" title="presentation display">presentation displays</a>.
          </li>
          <li>Set the <a href="#list-of-available-presentation-displays">list of available presentation displays</a> to
          empty.
          </li>
          <li>
            <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
            <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire
            an event</a> named <code>availablechange</code> at <em>E</em>
            (and only <em>E</em>) with the event's <code>available</code>
            property set to <code>false</code>.
          </li>
        </ol>
      </section>
    </section>
    <section>
      <h3 id="interface-availablechangeevent"><span class="secno">8 </span>
        <span>Interface <a href="#availablechangeevent"><code>AvailableChangeEvent</code></a></span>
      </h3>
      <pre class="idl"><span>[Constructor(DOMString type, optional <a href="#availablechangeeventinit">AvailableChangeEventInit</a> eventInitDict)]
interface <dfn id="availablechangeevent">AvailableChangeEvent</dfn> : Event {
  readonly attribute boolean available;
};

dictionary <dfn id="availablechangeeventinit">AvailableChangeEventInit</dfn> : EventInit {
  boolean available;
};
</span>
</pre>
      <p>
        An event named <code>availablechange</code> is fired during the
        execution of the <span>monitoring presentation display
        availability</span> algorithm when the <dfn id="presentation-display-availability">presentation display
        availability</dfn> changes. It is fired at the
        <a href="#presentationsession"><code>PresentationSession</code></a> object, using the
        <a href="#availablechangeevent"><code>AvailableChangeEvent</code></a> interface, with the
        <code>available</code> attribute set to the boolean value that the
        algorithm determined.
      </p>
    </section>
    <section>
      <h2 class="no-num" id="security-and-privacy-considerations">
        Security and privacy considerations
      </h2>
      <p class="open-issue">
        <a href="https://github.com/w3c/presentation-api/issues/45">ISSUE 45:
        Security and privacy considerations section</a>
      </p>
    </section>
    <section>
      <h2 class="no-num" id="references">
        References
      </h2>
      <div id="anolis-references"><dl><dt id="refsES6">[ES6]
<dd><cite><a href="http://people.mozilla.org/~jorendorff/es6-draft.html">ECMA-262 6th Edition / Draft</a></cite>. ECMA / Jason Orendorff.

<dt id="refsHTML5">[HTML5]
<dd><cite><a href="http://www.w3.org/html/wg/drafts/html/CR/">HTML5</a></cite>, Robin Berjon, Steve Faulkner, Travis Leithead et al.. W3C.

<dt id="refsPROMGUIDE">[PROMGUIDE]
<dd><cite><a href="http://www.w3.org/2001/tag/doc/promises-guide">Writing Promise-Using Specifications</a></cite>, Domenic Denicola. W3C.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsURL">[URL]
<dd><cite><a href="https://url.spec.whatwg.org/">URL</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsWEBIDL">[WEBIDL]
<dd><cite><a href="http://heycam.github.io/webidl/">Web IDL</a></cite>, Cameron McCormack. W3C.

</dl></div>
    </section>
    <section>
      <h2 class="no-num" id="acknowledgments">
        Acknowledgments
      </h2>
      <p>
        Thanks to Wayne Carr, Louay Bassbous, Anssi Kostiainen, 闵洪波 (Hongbo
        Min), Anton Vayvod, and Mark Foltz for help with editing, reviews and
        feedback to this draft.
      </p>
    </section>
  

